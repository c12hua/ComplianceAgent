## 文本标准化规则说明（当前实现）

### 输出总体说明
- 标准化后的文本以“句子列表的字符串”形式返回，形如：
  - `['句子1', '句子2', '句子3']`
- 每个元素为一条语句，使用单引号包裹；整个列表使用中括号包裹。
- 仅保留逗号（统一为中文逗号 `，`），其他标点（句号/问号/感叹号/分号/括号/引号/方括号/顿号等）会被移除（句末标点只用于分句，不会出现在最终输出）。

---

## 规则与示例

### 1) 基础字符与空白处理
- 规则：
  - 使用 NFKC 进行 Unicode 规范化（全角转半角等）。
  - 统一空白字符（中间过程用空格合并；最终每句内会移除多余空白）。
  - 换行符统一为 `\n`，随后按句子切分输出。
- 示例：
  - 输入：`４５ 岁\t\t 男\r\n` → 中间过程规范化 → 最终句内为紧凑文本（不保留空格），如 `45岁，男`。

### 2) 标点处理（仅保留逗号）
- 规则：
  - 清理重复标点：`！！！` → `！`，`？？` → `？`，`；；` → `；`。
  - 分句时保留句号/问号/感叹号/分号作为“分割符”，最终输出时移除这些句末标点。
  - 句内仅保留逗号，其余标点（括号、引号、方括号、冒号、顿号等）移除。
  - 英文逗号 `,` 统一为中文逗号 `，`。
- 示例：
  - 输入：`主诉头痛3天！！！曾诊断为高血压；现服用阿司匹林、布洛芬……` →
    `['主诉头痛3天', '曾诊断为高血压', '现服用阿司匹林布洛芬']`

### 3) 数字格式
- 规则：移除数字中的千分位逗号（例如 `1,234.56` → `1234.56`）。
- 示例：
  - 输入：`血糖 1,234.56 mg/dL` → `血糖1234.56mg/dL`

### 4) 日期标准化（YYYYMMDD）
- 规则：识别以下日期形式并统一为 `YYYYMMDD`：
  - `YYYY年M月D日/号`
  - `YYYY-M-D`
  - `YYYY/M/D`
  - `YYYY.M.D`
  - 月、日自动补零（例如 `2024-1-2` → `20240102`）。
- 示例：
  - 输入：`随访于2024年1月2日` → `随访于20240102`
  - 输入：`入院 2019-12-31` → `入院20191231`

### 5) 电话号码等数字连接符
- 规则：去除数字之间的连字符或长破折号，不改变数字顺序。
- 示例：
  - 输入：`联系电话：138-0013-8000` → `联系电话13800138000`

### 6) 医学术语（示例级映射）
- 规则：目前仅示例性地进行少量映射，实际项目可扩展（建议迁移到配置/数据文件）：
  - 药物名称：`阿司匹林肠溶片` → `阿司匹林`，`布洛芬缓释胶囊` → `布洛芬`，`对乙酰氨基酚片` → `对乙酰氨基酚`
  - 疾病名称：`高血压病` → `高血压`，`糖尿病 mellitus` → `糖尿病`，`冠心病` → `冠状动脉粥样硬化性心脏病`

### 7) 页眉页脚清理
- 规则：移除简单页码格式：`第 X 页`、`Page X`。
- 示例：
  - 输入：`第 1 页` 或 `Page 2` → 从文本中移除。

### 8) 繁简转换（有限字符集）
- 规则：对常见的繁体字做简化（目前覆盖：醫/藥/診/療/檢/驗/報/告 → 医/药/诊/疗/检/验/报/告）。
- 示例：
  - 输入：`MRI（頭部）已檢，報告如下` → `MRI頭部已检，报告如下`

### 9) 分句与最终输出
- 规则：
  - 分句依据：`。！？；` 以及英文 `? ! ;` 与省略号（`…`/`...`）。
  - 每句内仅保留逗号（统一为中文逗号 `，`）；其他标点移除；去除空白。
  - 最终返回“单引号包裹的句子列表（字符串）”。
- 示例：
  - 输入：
    ```
    患者张某，男，45岁，主诉头痛3天。曾诊断为高血压，现服用降压药。医保卡号为12345678，进行MRI检查并开具电子处方。
    ```
  - 输出：
    ```
    ['患者张某，男，45岁，主诉头痛3天', '曾诊断为高血压，现服用降压药', '医保卡号为12345678，进行MRI检查并开具电子处方']
    ```

---

## 使用方法

### 后端接口
- 路径：`/api/pii/detect/`（POST）
- 传参方式：
  - JSON：`{"text": "...原文..."}`
  - 文件上传：`multipart/form-data` 字段名 `file`（支持 `.txt/.docx/.pdf`）
- 标准化结果位置：响应 JSON 的 `normalized_text.normalized_text`

### curl 示例
```bash
# JSON 文本
curl -s -X POST http://localhost:8000/api/pii/detect/ \
  -H "Content-Type: application/json" \
  -d '{"text":"患者张某，男，45岁，主诉头痛3天。曾诊断为高血压，现服用降压药。医保卡号为12345678，进行MRI检查并开具电子处方。"}' \
| jq -r '.normalized_text.normalized_text'

# 上传 .txt 或 .docx 文件
curl -s -X POST http://localhost:8000/api/pii/detect/ \
  -F "file=@/absolute/path/to/sample.txt" \
| jq -r '.normalized_text.normalized_text'
```

