# RAG 模块（2人、刘岩）

## 功能1：知识库向量化

**输入参数**：json化的知识库

**输出参数**：向量化的知识库

**时间**：8.18-8.22

**功能详述**：将json数据库向量化，将文本内容转换成数据想想存储再vector database中，向量数据库可选择[Milvus](https://github.com/milvus-io/milvus)。

**举例**：

| 文本知识库   | 向量化知识库 |
|--------|------|
| {<br> "question": "...",<br>"answer": ["..."],<br>"positive_contexts": [{ "content": "...", "source": "..." }],<br>"category": "...",<br>"type": "Basic"<br>} | [<br> 0.01234, -0.07845, 0.09231, ..., 0.00323<br>]  |


## 功能2：文本向量化

**输入参数**：json化的输入文本，数据库中读取（PII Module的输出内容）

**输出参数**：向量化的病例文本

**时间**：8.18-8.22

**功能详述**：将json文本向量化。

**举例**：

| json病例文本   | 向量化病例文本 |
|--------|------|
| { <br> "text": "患者张某，男，45岁，主诉头痛3天。曾诊断为高血压，现服用降压药。医保卡号为12345678，进行MRI检查并开具电子处方。",<br>"entities": [<br>{"entity": "张某", "type": "姓名"},<br> {"entity": "头痛", "type": "症状"}, <br>{"entity": "高血压", "type": "疾病"},<br> {"entity": "降压药", "type": "药物"},<br>{"entity": "医保卡号", "type": "支付信息"},<br>  {"entity": "MRI检查", "type": "检查项目"},  <br>  {"entity": "电子处方", "type": "处方"}<br> ]<br>}| [<br> 0.01234, -0.07845, 0.09231, ..., 0.00323<br>]  |

## 功能3：RAG检索

**输入参数**：向量化病例文本

**输出参数**：检索结果

**时间**：8.22-8.25

**功能详述**：将向量化的病例文本在向量知识库中进行匹配，返回相似度高的几个片段。




## 功能4：RAG参数调节及实验

**输入参数**：json病例文本

**输出参数**：：参数组合、准确率、用户评分，如表格所示

**时间**：8.25-8.31

# RAG 调参实验记录表

| 实验编号 | Top-k | Chunk 大小 | Overlap | Temperature | Max Tokens | Top-p | Top-k(采样) | 准确率(%) | 答案完整性 | 幻觉率 | 评分(1-5) | 备注 |
|----------|-------|------------|---------|-------------|------------|-------|-------------|-----------|-------------|--------|----------------|------|
| 1        | 5     | 300        | 50      | 0.2         | 512        | 0.9   | 40          |           |             |        |                |      |
| 2        | 8     | 400        | 80      | 0.1         | 512        | 0.8   | 30          |           |             |        |                |      |
| 3        | 3     | 250        | 50      | 0.3         | 256        | 0.85  | 50          |           |             |        |                |      |
| 4        |       |            |         |             |            |       |             |           |             |        |                |      |



---

## 指标说明
- **准确率(%)**：与标准答案或人工标注的匹配度。  
- **答案完整性**：是否覆盖了问题需要的关键信息（高/中/低）。  
- **幻觉率**：模型回答中无根据内容的占比（高/中/低）。  
- **用户评分**：人工打分，评估可读性和有用性。  
- **备注**：记录特殊情况（如检索结果不相关、生成过长等）。  





### 🔹 检索侧参数
| 参数名         | 推荐范围 / 常见值 | 调优目标 |
|----------------|------------------|----------|
| Top-k          | 3 ~ 10           | 控制检索返回文档数量，平衡召回率与噪声 |
| 相似度阈值     | 0.5 ~ 0.8（余弦相似度） | 过滤低相关文档，提高答案相关性 |
| Chunk 大小     | 200 ~ 500 tokens | 保证语义完整性与检索精度 |
| Chunk 重叠度   | 50 ~ 100 tokens  | 避免语义被截断，保证上下文连贯 |
| Embedding 维度 | 384, 768, 1024   | 提升语义表示能力，兼顾速度与存储 |
| 索引参数（如 HNSW efSearch） | 50 ~ 200 | 调整检索精度与速度的平衡 |

---

### 🔹 生成侧参数
| 参数名        | 推荐范围 / 常见值 | 调优目标 |
|---------------|------------------|----------|
| Temperature   | 0.1 ~ 0.3        | 控制随机性，保证答案稳定一致 |
| Max Tokens    | 256 ~ 1024       | 限制输出长度，避免过长或截断 |
| Top-p (采样)  | 0.7 ~ 0.9        | 控制生成多样性，避免过度随机 |
| Top-k (采样)  | 20 ~ 50          | 限制采样词空间，减少无关答案 |
| Prompt 设计   | 明确任务指令 + 引用文档 | 减少幻觉，保证基于检索结果回答 |

---

### 🔹 调优流程建议
1. **先调检索**：优先调节 `Top-k`、`Chunk 大小`，确保检索结果相关。  
2. **再调生成**：固定检索配置，调 `Temperature`、`Max Tokens`，控制输出质量。  
3. **对比实验**：记录不同参数组合下的指标（准确率、答案完整性、引用率）。  




